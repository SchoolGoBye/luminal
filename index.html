<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GameFlow Proxy with Brave Search & Themes</title>
  <style>
    :root {
      --color-bg: #0f2027;
      --color-fg: #cfd8dc;
      --color-accent: #00ffff;
      --color-box: #203a43;
      --color-btn: #005f9e;
      --color-btn-hover: #0080ff;
      --color-border: #00ffffaa;
    }
    body.theme-default {
      --color-bg: #0f2027;
      --color-fg: #cfd8dc;
      --color-accent: #00ffff;
      --color-box: #203a43;
      --color-btn: #005f9e;
      --color-btn-hover: #0080ff;
      --color-border: #00ffffaa;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    }
    body.theme-evil-red {
      --color-bg: #230000;
      --color-fg: #ffd6d6;
      --color-accent: #ff2222;
      --color-box: #400000;
      --color-btn: #a00000;
      --color-btn-hover: #ff2222;
      --color-border: #ff2222bb;
      background: radial-gradient(ellipse at top left, #ff2222 0%, #230000 100%);
    }
    body.theme-winter {
      --color-bg: #eaf6ff;
      --color-fg: #1a2a3a;
      --color-accent: #0099ff;
      --color-box: #cce6ff;
      --color-btn: #0099ff;
      --color-btn-hover: #66ccff;
      --color-border: #0099ffaa;
      background: linear-gradient(135deg, #eaf6ff 0%, #bcdfff 100%);
    }
    body.theme-spring {
      --color-bg: #eaffea;
      --color-fg: #204020;
      --color-accent: #00cc66;
      --color-box: #d6ffd6;
      --color-btn: #00cc66;
      --color-btn-hover: #66ffb2;
      --color-border: #00cc66aa;
      background: linear-gradient(135deg, #eaffea 0%, #b6ffb6 100%);
    }
    body.theme-summer {
      --color-bg: #fff7e6;
      --color-fg: #4d2e00;
      --color-accent: #ffb300;
      --color-box: #ffe0b2;
      --color-btn: #ffb300;
      --color-btn-hover: #ffd54f;
      --color-border: #ffb300aa;
      background: linear-gradient(135deg, #fff7e6 0%, #ffe082 100%);
    }
    body.theme-fall {
      --color-bg: #fff4e6;
      --color-fg: #4d2600;
      --color-accent: #ff6600;
      --color-box: #ffd9b3;
      --color-btn: #ff6600;
      --color-btn-hover: #ffb366;
      --color-border: #ff6600aa;
      background: linear-gradient(135deg, #fff4e6 0%, #ffb366 100%);
    }
    body.theme-school {
      --color-bg: #f7f7ee;
      --color-fg: #2d3a4a;
      --color-accent: #4e8cff;
      --color-box: #f3eecb;
      --color-btn: #ffd700;
      --color-btn-hover: #4e8cff;
      --color-border: #4e8cffaa;
      background: linear-gradient(120deg, #f7f7ee 0%, #f3eecb 50%, #4e8cff 100%);
    }
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: var(--color-bg);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--color-fg);
      overflow: hidden;
      width: 100vw; height: 100vh;
      transition: background 0.3s;
    }
    #particleCanvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
      background: transparent;
      transition: background 0.6s;
    }
    .navbar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 54px;
      background: var(--color-box);
      padding: 8px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 0 15px var(--color-border);
      user-select: none;
      z-index: 20;
      display: none;
    }
    .navbar-left {
      display: flex;
      gap: 10px;
      flex-grow: 1;
      align-items: center;
    }
    .navbar input {
      padding: 8px 10px;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      background: var(--color-bg);
      color: var(--color-fg);
      box-shadow: inset 0 0 8px var(--color-border);
      flex-grow: 0;
      width: 250px;
      outline-offset: 2px;
      outline-color: var(--color-accent);
      height: 36px;
      transition: box-shadow 0.2s;
    }
    .navbar input:focus {
      background-color: var(--color-box);
      box-shadow: 0 0 12px var(--color-border), inset 0 0 12px var(--color-border);
      outline-color: var(--color-accent);
    }
    #generateBtnNav {
      width: 60px;
      padding: 6px 0;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 6px;
      border: none;
      background: linear-gradient(45deg, var(--color-accent), var(--color-btn));
      color: var(--color-bg);
      cursor: pointer;
      box-shadow: 0 0 15px var(--color-border);
      transition: background 0.3s, box-shadow 0.3s;
      flex-shrink: 0;
      user-select: none;
      letter-spacing: 0.05em;
      height: 36px;
    }
    #generateBtnNav:hover:not(:disabled) {
      background: linear-gradient(45deg, var(--color-accent), var(--color-btn-hover));
      box-shadow: 0 0 25px var(--color-border);
      color: var(--color-fg);
    }
    #generateBtnNav:disabled {
      background: var(--color-box);
      color: var(--color-box);
      cursor: not-allowed;
      box-shadow: none;
    }
    .controls {
      display: flex;
      gap: 12px;
      margin-left: 20px;
    }
    .controls button {
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 6px;
      border: 1.5px solid var(--color-border);
      background: transparent;
      color: var(--color-accent);
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      font-size: 20px;
      line-height: 1;
      box-shadow: 0 0 10px var(--color-border);
    }
    .controls button:hover:not(:disabled) {
      background-color: var(--color-accent);
      color: var(--color-bg);
      box-shadow: 0 0 20px var(--color-accent);
    }
    .controls button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      box-shadow: none;
      color: var(--color-box);
      border-color: var(--color-box);
    }
    #app {
      position: relative;
      z-index: 10;
      max-width: 100vw;
      margin: 60px auto 0 auto;
      padding: 0 20px;
      text-align: center;
      user-select: none;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: calc(100vh - 60px);
    }
    h1 {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 3rem;
      color: var(--color-accent);
      text-shadow:
        0 0 5px var(--color-accent),
        0 0 10px var(--color-accent),
        0 0 20px var(--color-accent),
        0 0 40px var(--color-accent);
      margin-bottom: 10px;
      letter-spacing: 0.1em;
    }
    form {
      background: var(--color-box);
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow:
        0 0 15px var(--color-border),
        inset 0 0 10px var(--color-border);
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: center;
      max-width: 700px;
      margin: 0 auto 20px;
      transition: box-shadow 0.3s;
    }
    form:hover {
      box-shadow:
        0 0 25px var(--color-border),
        inset 0 0 15px var(--color-border);
    }
    input[type="text"] {
      flex-grow: 1;
      min-width: 250px;
      padding: 12px 18px;
      font-size: 1.1rem;
      border-radius: 8px;
      border: none;
      background: var(--color-bg);
      color: var(--color-fg);
      box-shadow: inset 0 0 8px var(--color-border);
      outline-offset: 2px;
      outline-color: var(--color-accent);
      transition: background-color 0.3s, box-shadow 0.3s;
    }
    input[type="text"]:focus {
      background-color: var(--color-box);
      box-shadow: 0 0 12px var(--color-border), inset 0 0 12px var(--color-border);
      outline-color: var(--color-accent);
    }
    button[type="submit"] {
      padding: 12px 28px;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 8px;
      border: none;
      background: linear-gradient(45deg, var(--color-accent), var(--color-btn));
      color: var(--color-bg);
      cursor: pointer;
      box-shadow: 0 0 15px var(--color-border);
      transition: background 0.3s, box-shadow 0.3s;
      user-select: none;
      min-width: 120px;
      letter-spacing: 0.05em;
    }
    button[type="submit"]:hover {
      background: linear-gradient(45deg, var(--color-accent), var(--color-btn-hover));
      box-shadow: 0 0 25px var(--color-border);
      color: var(--color-fg);
    }
    button[type="submit"]:disabled {
      background: var(--color-box);
      color: var(--color-box);
      cursor: not-allowed;
      box-shadow: none;
    }
    #output {
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9rem;
      color: var(--color-accent);
      word-break: break-word;
      min-height: 1.5em;
      margin-top: 0;
      user-select: text;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 10px;
    }
    .iframe-container {
      width: 90vw;
      max-width: 1200px;
      aspect-ratio: 16 / 9;
      min-height: 350px;
      max-height: 75vh;
      margin: 0 auto;
      background: var(--color-box);
      border-radius: 16px;
      box-shadow: 0 0 40px var(--color-border);
      display: none;
      position: relative;
      overflow: hidden;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 16px;
      background: white;
      display: block;
    }
    /* Options Tab - bottom right, gradient background */
    .options-tab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      min-width: 220px;
      padding: 18px 22px;
      border-radius: 16px;
      z-index: 50;
      display: none;
      flex-direction: column;
      align-items: flex-start;
      border: 2px solid var(--color-border);
      background: linear-gradient(45deg, var(--color-accent), var(--color-btn-hover), var(--color-box));
      color: var(--color-fg);
      box-shadow: 0 0 20px var(--color-border);
      animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: none;}
    }
    .options-tab.active {
      display: flex;
    }
    .theme-picker-label {
      font-weight: bold;
      margin-bottom: 8px;
    }
    .theme-picker-list {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .theme-btn {
      padding: 7px 16px;
      border-radius: 8px;
      border: 2px solid var(--color-border);
      background: var(--color-btn);
      color: var(--color-fg);
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, border 0.2s;
      margin-bottom: 4px;
    }
    .theme-btn.active, .theme-btn:focus {
      border: 2.5px solid var(--color-accent);
      background: var(--color-btn-hover);
      color: var(--color-bg);
      outline: none;
    }
    .options-close-btn {
      align-self: flex-end;
      margin-top: 10px;
      background: var(--color-accent);
      color: var(--color-bg);
      border: none;
      border-radius: 6px;
      padding: 4px 14px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 0 8px var(--color-border);
    }
    #openOptionsBtn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 51;
      padding: 8px 18px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(45deg, var(--color-accent), var(--color-btn-hover));
      color: var(--color-bg);
      font-weight: 700;
      box-shadow: 0 0 8px var(--color-border);
      cursor: pointer;
      transition: background 0.3s;
      display: block;
    }
    #openOptionsBtn.hide {
      display: none;
    }
    #openOptionsBtn:hover {
      background: linear-gradient(45deg, var(--color-accent), var(--color-btn));
      color: var(--color-fg);
    }
    @media (max-width: 700px) {
      .iframe-container { aspect-ratio: 4 / 3; }
      h1 { font-size: 1.2rem; margin-top: 60px;}
      .options-tab { right: 10px; bottom: 10px; }
      #openOptionsBtn { right: 10px; bottom: 10px; }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet" />
</head>
<body>
  <!-- Options Tab -->
  <div class="options-tab" id="optionsTab" aria-label="Options">
    <div class="theme-picker-label">Theme:</div>
    <div class="theme-picker-list">
      <button class="theme-btn" data-theme="default">Default</button>
      <button class="theme-btn" data-theme="evil-red">Evil Red</button>
      <button class="theme-btn" data-theme="winter">Winter</button>
      <button class="theme-btn" data-theme="spring">Spring</button>
      <button class="theme-btn" data-theme="summer">Summer</button>
      <button class="theme-btn" data-theme="fall">Fall</button>
      <button class="theme-btn" data-theme="school">School</button>
    </div>
    <button class="options-close-btn" id="closeOptionsBtn">Close</button>
  </div>
  <!-- Options Button -->
  <button id="openOptionsBtn">
    Options
  </button>

  <canvas id="particleCanvas"></canvas>

  <div class="navbar" id="navbar" role="navigation" aria-label="Proxy navigation bar">
    <div class="navbar-left">
      <input type="text" id="siteInputNav" placeholder="Enter a site URL or text" aria-label="Site URL or search term" spellcheck="false" />
      <button id="generateBtnNav" aria-label="Generate Embed URL or Search">Go</button>
    </div>
    <div class="controls">
      <button id="backBtn" disabled aria-label="Back" title="Back">&#8592;</button>
      <button id="forwardBtn" disabled aria-label="Forward" title="Forward">&#8594;</button>
      <button id="refreshBtn" disabled aria-label="Refresh" title="Refresh">&#10227;</button>
      <button id="homeBtn" aria-label="Home" title="Home">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" width="20" height="20" fill="currentColor" >
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
      </button>
    </div>
  </div>

  <div id="app" role="main" aria-label="GameFlow Proxy Application">
    <h1>Luminal</h1>
    <form id="urlForm" autocomplete="off" spellcheck="false" aria-label="Embed URL Generator Form">
      <input type="text" id="siteInput" placeholder="Enter a site URL or search term" aria-label="Site URL or search term" />
      <button type="submit" id="generateBtnForm" aria-label="Generate Embed URL">Generate</button>
    </form>
    <p id="output" aria-live="polite" aria-atomic="true"></p>
    <div class="iframe-container" id="iframeContainer">
      <iframe id="proxyIframe" allowfullscreen></iframe>
    </div>
  </div>

  <audio id="clickSound" src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3" preload="auto"></audio>

  <script>
    // Particle colors per theme
    const themeParticles = {
      "default": [
        'rgba(0,255,255,',
        'rgba(255,0,255,',
        'rgba(255,255,0,',
        'rgba(255,255,255,'
      ],
      "evil-red": [
        'rgba(255,34,34,',
        'rgba(255,0,0,',
        'rgba(255,128,128,',
        'rgba(255,255,255,'
      ],
      "winter": [
        'rgba(0,153,255,',
        'rgba(200,240,255,',
        'rgba(255,255,255,',
        'rgba(150,200,255,'
      ],
      "spring": [
        'rgba(0,204,102,',
        'rgba(102,255,178,',
        'rgba(255,255,204,',
        'rgba(255,182,193,'
      ],
      "summer": [
        'rgba(255,179,0,',
        'rgba(255,213,79,',
        'rgba(255,255,153,',
        'rgba(255,255,255,'
      ],
      "fall": [
        'rgba(255,102,0,',
        'rgba(255,179,102,',
        'rgba(204,102,0,',
        'rgba(255,255,204,'
      ],
      "school": [
        'rgba(78,140,255,',   // blue
        'rgba(255,215,0,',    // yellow
        'rgba(60,179,113,',   // green
        'rgba(255,255,255,'
      ]
    };

    const themeBtns = document.querySelectorAll('.theme-btn');
    const optionsTab = document.getElementById('optionsTab');
    const openOptionsBtn = document.getElementById('openOptionsBtn');
    const closeOptionsBtn = document.getElementById('closeOptionsBtn');

    let currentTheme = localStorage.getItem('theme') || 'default';

    function setTheme(theme) {
      document.body.className = '';
      document.body.classList.add('theme-' + theme);
      localStorage.setItem('theme', theme);
      themeBtns.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === theme);
      });
      currentTheme = theme;
      setParticleColors(themeParticles[theme]);
    }

    themeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        setTheme(btn.dataset.theme);
      });
    });

    openOptionsBtn.addEventListener('click', () => {
      optionsTab.classList.add('active');
      openOptionsBtn.classList.add('hide');
    });
    closeOptionsBtn.addEventListener('click', () => {
      optionsTab.classList.remove('active');
      openOptionsBtn.classList.remove('hide');
    });
    // Close options tab if clicking outside
    document.addEventListener('mousedown', e => {
      if (
        optionsTab.classList.contains('active') &&
        !optionsTab.contains(e.target) &&
        e.target !== openOptionsBtn
      ) {
        optionsTab.classList.remove('active');
        openOptionsBtn.classList.remove('hide');
      }
    });

    // Particle animation setup
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    let particles = [];
    let particleColors = themeParticles[currentTheme];

    function setParticleColors(colors) {
      particleColors = colors;
      particles.forEach(p => {
        p.colorIndex = Math.floor(Math.random() * particleColors.length);
        p.color = particleColors[p.colorIndex];
      });
    }

    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * width;
        this.y = Math.random() * height;
        this.vx = (Math.random() - 0.5) * (Math.random() * 2 + 0.5);
        this.vy = (Math.random() - 0.5) * (Math.random() * 2 + 0.5);
        this.size = Math.random() * 3 + 1;
        this.baseAlpha = Math.random() * 0.5 + 0.3;
        this.alpha = this.baseAlpha;
        this.alphaDirection = Math.random() < 0.5 ? 1 : -1;
        this.colorIndex = Math.floor(Math.random() * particleColors.length);
        this.color = particleColors[this.colorIndex];
        this.pulseSpeed = Math.random() * 0.02 + 0.01;
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        if (this.x < 0) { this.x = 0; this.vx = -this.vx; }
        if (this.x > width) { this.x = width; this.vx = -this.vx; }
        if (this.y < 0) { this.y = 0; this.vy = -this.vy; }
        if (this.y > height) { this.y = height; this.vy = -this.vy; }
        this.alpha += this.alphaDirection * this.pulseSpeed;
        if (this.alpha >= this.baseAlpha + 0.3) this.alphaDirection = -1;
        if (this.alpha <= this.baseAlpha - 0.3) this.alphaDirection = 1;
      }
      draw() {
        ctx.beginPath();
        const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 4);
        gradient.addColorStop(0, this.color + this.alpha + ')');
        gradient.addColorStop(1, this.color + '0)');
        ctx.fillStyle = gradient;
        ctx.arc(this.x, this.y, this.size * 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.fillStyle = this.color + this.alpha + ')';
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function initParticles(count) {
      particles = [];
      for (let i = 0; i < count; i++) {
        particles.push(new Particle());
      }
    }

    initParticles(150);

    function animate() {
      ctx.clearRect(0, 0, width, height);
      particles.forEach(p => { p.update(); p.draw(); });
      requestAnimationFrame(animate);
    }

    animate();

    // Sound effect
    const clickSound = document.getElementById('clickSound');
    function playClickSound() {
      const soundClone = clickSound.cloneNode();
      soundClone.play();
    }

    // Embed proxy logic
    const baseUrl = "https://frogie.faizinternational.com.np";
    const blockedDomains = ["google.com", "www.google.com", "atari.com", "www.atari.com"];

    const siteInput = document.getElementById("siteInput");
    const urlForm = document.getElementById("urlForm");
    const output = document.getElementById("output");
    const iframeContainer = document.getElementById("iframeContainer");
    const preview = document.getElementById("proxyIframe");
    const navbar = document.getElementById("navbar");
    const backBtn = document.getElementById("backBtn");
    const forwardBtn = document.getElementById("forwardBtn");
    const refreshBtn = document.getElementById("refreshBtn");
    const siteInputNav = document.getElementById("siteInputNav");
    const generateBtnNav = document.getElementById("generateBtnNav");
    const homeBtn = document.getElementById("homeBtn");

    let historyStack = [];
    let historyIndex = -1;
    let lastSrc = "";

    function getDomain(url) {
      try {
        return new URL(url).hostname.toLowerCase();
      } catch {
        return null;
      }
    }

    function createEmbedUrl(input) {
      const domainPattern = /^[a-z0-9.-]+\.[a-z]{2,6}$/i;
      let targetUrl = "";

      if (input.startsWith("http://") || input.startsWith("https://")) {
        targetUrl = input;
      } else if (domainPattern.test(input)) {
        targetUrl = "https://" + input;
      } else {
        // Use Brave Search for queries
        targetUrl = `https://search.brave.com/search?q=${encodeURIComponent(input)}`;
      }

      const domain = getDomain(targetUrl);
      if (domain && blockedDomains.some(blocked => domain.endsWith(blocked))) {
        alert(`Embedding URLs from "${domain}" is not allowed.`);
        return null;
      }

      return `${baseUrl}/embed.html#${targetUrl}`;
    }

    function extractUrlFromEmbed(embedUrl) {
      const idx = embedUrl.indexOf('#');
      if (idx === -1) return '';
      return embedUrl.substring(idx + 1);
    }

    function updateNavigationButtons() {
      backBtn.disabled = historyIndex <= 0;
      forwardBtn.disabled = historyIndex >= historyStack.length - 1;
      refreshBtn.disabled = historyIndex === -1;
    }

    function loadUrl(url, addToHistory = true) {
      preview.src = url;
      output.textContent = url;
      navbar.style.display = "flex";
      iframeContainer.style.display = "flex";
      siteInputNav.value = extractUrlFromEmbed(url);

      if (addToHistory) {
        if (historyIndex < historyStack.length - 1) {
          historyStack = historyStack.slice(0, historyIndex + 1);
        }
        historyStack.push(url);
        historyIndex++;
      }
      updateNavigationButtons();
    }

    preview.addEventListener("load", () => {
      if (historyIndex >= 0 && historyIndex < historyStack.length) {
        siteInputNav.value = extractUrlFromEmbed(historyStack[historyIndex]);
      }
    });

    function embedInput(input) {
      input = input.trim();
      if (!input) return;

      const embedUrl = createEmbedUrl(input);
      if (!embedUrl) return;

      // Hide initial form and output
      urlForm.style.display = 'none';
      output.style.display = 'none';

      // Force reload if same URL
      if (preview.src === embedUrl) {
        preview.src = 'about:blank';
        setTimeout(() => {
          loadUrl(embedUrl, false);
        }, 50);
      } else {
        loadUrl(embedUrl);
      }

      playClickSound();
    }

    urlForm.addEventListener("submit", e => {
      e.preventDefault();
      embedInput(siteInput.value);
    });

    siteInputNav.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        embedInput(siteInputNav.value);
      }
    });

    generateBtnNav.addEventListener("click", () => {
      embedInput(siteInputNav.value);
    });

    backBtn.addEventListener("click", () => {
      if (historyIndex > 0) {
        historyIndex--;
        loadUrl(historyStack[historyIndex], false);
      }
    });

    forwardBtn.addEventListener("click", () => {
      if (historyIndex < historyStack.length - 1) {
        historyIndex++;
        loadUrl(historyStack[historyIndex], false);
      }
    });

    refreshBtn.addEventListener("click", () => {
      if (historyIndex !== -1) {
        const currentUrl = historyStack[historyIndex];
        preview.src = 'about:blank';
        setTimeout(() => {
          preview.src = currentUrl;
        }, 50);
      }
    });

    homeBtn.addEventListener("click", () => {
      // Clear history and reset UI to front page
      historyStack = [];
      historyIndex = -1;
      preview.src = '';
      iframeContainer.style.display = 'none';
      navbar.style.display = 'none';
      urlForm.style.display = 'flex';
      output.style.display = 'block';
      output.textContent = '';
      siteInputNav.value = '';
      siteInput.value = '';
    });

    // --- MutationObserver to track iframe src changes ---
    const observer = new MutationObserver(mutations => {
      for (const mutation of mutations) {
        if (mutation.type === "attributes" && mutation.attributeName === "src") {
          const newSrc = preview.src;
          if (newSrc && newSrc !== lastSrc) {
            if (historyIndex < historyStack.length - 1) {
              historyStack = historyStack.slice(0, historyIndex + 1);
            }
            historyStack.push(newSrc);
            historyIndex = historyStack.length - 1;
            updateNavigationButtons();
            lastSrc = newSrc;
          }
        }
      }
    });
    observer.observe(preview, { attributes: true, attributeFilter: ["src"] });

    // Initialize theme and particles on load
    setTheme(currentTheme);
  </script>
</body>
</html>
